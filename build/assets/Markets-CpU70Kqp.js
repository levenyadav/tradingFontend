import{j as t}from"./radix-D5295bUi.js";import{r as o}from"./charts-Dh6mNU2f.js";import{c as X,j as Q,a as V,b as C,g as Z,m as ee,w as P,I as te,S as T,E as se,f as M,T as ne,d as re,p as _,r as ae,e as oe}from"./index-CxMdxSJL.js";import{S as H}from"./search-CJhr66dV.js";import"./vendor-DDxydHEc.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],le=X("star",ce);function ie(u,c){return u.toUpperCase().includes("BTC")?"crypto":"forex"}async function de(){return((await Q("/api/v1/market/overview",{method:"GET",headers:V()},3,250))?.data?.overview||[]).map(a=>{const l=(a.symbol||"").toUpperCase(),g=C(a.price);return{pair:l,name:l,bidPrice:g,askPrice:g,spread:0,change24h:0,changePercent24h:C(a.changePercent),high24h:C(a.high24h),low24h:C(a.low24h),volume:C(a.volume24h),category:ie(l,a.category),isFavorite:!1}})}function ue(u,c){try{const a=localStorage.getItem(u);if(!a)return null;const l=JSON.parse(a);return c&&l&&typeof l.ts=="number"&&Date.now()-l.ts>c?null:l&&l.data!=null?l.data:null}catch{return null}}function he(u){try{const c=localStorage.getItem(u);if(!c)return null;const a=JSON.parse(c);return a&&a.data!=null?a.data:null}catch{return null}}function me(u,c){try{const a={ts:Date.now(),data:c};localStorage.setItem(u,JSON.stringify(a))}catch{}}const fe={USD:"us",EUR:"eu",GBP:"gb",JPY:"jp",CHF:"ch",AUD:"au",CAD:"ca",NZD:"nz",CNY:"cn",HKD:"hk",SGD:"sg",SEK:"se",NOK:"no",TRY:"tr",ZAR:"za",MXN:"mx",PLN:"pl",INR:"in",BRL:"br",KRW:"kr"};function O(u){const c=u.toUpperCase();return fe[c]||null}function be(u){const c=u.split("/");return c.length!==2?null:{base:c[0].toUpperCase(),quote:c[1].toUpperCase()}}function ge({pair:u,size:c=28}){const a=be(u);if(!a)return null;const l=O(a.base),g=O(a.quote);if(!l&&!g)return null;const x=c,w=Math.max(14,Math.floor(c*.6));return t.jsxs("div",{style:{position:"relative",width:x,height:x},"aria-hidden":!0,children:[l?t.jsx("span",{className:`fi fis fi-${l}`,style:{fontSize:x,borderRadius:x/2,boxShadow:"0 0 0 1px rgba(0,0,0,0.1)"}}):t.jsx("span",{style:{display:"inline-block",width:x,height:x,borderRadius:x/2,background:"#eee"}}),g?t.jsx("span",{className:`fi fis fi-${g}`,style:{position:"absolute",right:-2,bottom:-2,fontSize:w,borderRadius:w/2,boxShadow:"0 0 0 1px rgba(0,0,0,0.1)"}}):null]})}function Ne({onSelectPair:u}){const[c,a]=o.useState(""),[l,g]=o.useState("all"),[x,w]=o.useState([]),[p,N]=o.useState([]),[F,I]=o.useState(!1),[A,q]=o.useState(null),v=["all","forex","commodities","indices","crypto"],U=o.useRef(null);o.useEffect(()=>{(async()=>{try{const e=await Z();w(e.map(n=>n.symbol))}catch{}})()},[]),o.useEffect(()=>{const e=ue("market_overview_pairs",12e4);e&&e.length&&p.length===0&&N(e);let n=!0;return(async()=>{I(!0);try{const r=await de();n&&(N(r),me("market_overview_pairs",r))}catch(r){if(n){const i=he("market_overview_pairs")||[];i.length&&p.length===0&&N(i),!i.length&&p.length===0&&N(ee),q(r?.message||"Failed to load markets")}}finally{n&&I(!1)}})(),()=>{n=!1}},[]);const[S,B]=o.useState([]),[k,$]=o.useState(20),y=o.useRef(null),[D,Y]=o.useState(0),[R,L]=o.useState(30),[j,W]=o.useState(120),z=o.useRef(null);o.useEffect(()=>{const e=(p.length>0?p:[]).slice(0,k).map(n=>n.pair.toUpperCase());B(e)},[p.length,k]),o.useEffect(()=>{P.connect(),S.length>0&&P.subscribe({symbols:S});const e={};let n=null;const r=()=>{N(d=>{if(!d||d.length===0)return d;let f=d;for(const s of Object.keys(e)){const h=e[s],m=f.findIndex(b=>b.pair===s);if(m!==-1){const b=f[m],G={...b,bidPrice:typeof h.bid=="number"?h.bid:b.bidPrice,askPrice:typeof h.ask=="number"?h.ask:b.askPrice,changePercent24h:typeof h.changePercent=="number"?h.changePercent:b.changePercent24h};f===d&&(f=[...d]),f[m]=G}}return f});for(const d of Object.keys(e))delete e[d];n=null},i=d=>{const f=String(d.symbol||"").toUpperCase();e[f]=d,n==null&&(n=requestAnimationFrame(r))};return P.on("PRICE_UPDATE",i),()=>{S.length>0&&P.unsubscribe({symbols:S}),P.off("PRICE_UPDATE",i),n!=null&&cancelAnimationFrame(n)}},[S.join(",")]);const K=[{id:"all",label:"All"},{id:"forex",label:"Forex"},{id:"commodities",label:"Commodities"},{id:"indices",label:"Indices"},{id:"crypto",label:"Crypto"}],J=async e=>{const n=e.toUpperCase();if(x.includes(n)){w(r=>r.filter(i=>i!==n)),_("remove");try{await ae(n)}catch{}}else{w(r=>[...r,n]),_("add");try{await oe(n)}catch{}}},E=p.filter(e=>{const n=e.pair.toLowerCase().includes(c.toLowerCase())||e.name.toLowerCase().includes(c.toLowerCase()),r=l==="all"||e.category===l;return n&&r});return o.useEffect(()=>{const e=()=>{if(window.innerHeight+window.scrollY>=document.body.offsetHeight-200&&$(r=>Math.min(r+20,p.length||r+20)),y.current){const r=y.current.getBoundingClientRect().top+window.scrollY,i=Math.max(0,window.scrollY-r),d=Math.floor(i/Math.max(1,j)),f=Math.max(0,d-10);Y(f),L(30)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[p.length]),o.useEffect(()=>{if(!y.current)return;requestAnimationFrame(()=>{const r=y.current.querySelector("button.w-full")?.getBoundingClientRect().height;r&&r>0&&W(Math.round(r))})},[E.length,D,R,k]),o.useEffect(()=>{if(!y.current)return;z.current?.disconnect();const e=new IntersectionObserver(()=>{const r=window.innerHeight,i=Math.max(10,Math.ceil(r/Math.max(1,j))+10);L(i)});e.observe(y.current),z.current=e;const n=()=>{const r=Math.max(10,Math.ceil(window.innerHeight/Math.max(1,j))+10);L(r)};return window.addEventListener("resize",n),()=>{e.disconnect(),window.removeEventListener("resize",n)}},[j]),o.useEffect(()=>{const e=U.current;if(!e)return;let n=0,r=0,i=0,d=0;const f=m=>{m.touches.length===1&&(n=m.touches[0].clientX,r=m.touches[0].clientY,i=0,d=0)},s=m=>{m.touches.length===1&&(i=m.touches[0].clientX-n,d=m.touches[0].clientY-r)},h=()=>{if(Math.abs(i)>40&&Math.abs(d)<25){const m=v.indexOf(l);if(i<0){const b=v[(m+1)%v.length];g(b)}else{const b=v[(m-1+v.length)%v.length];g(b)}}n=0,r=0,i=0,d=0};return e.addEventListener("touchstart",f,{passive:!0}),e.addEventListener("touchmove",s,{passive:!0}),e.addEventListener("touchend",h),()=>{e.removeEventListener("touchstart",f),e.removeEventListener("touchmove",s),e.removeEventListener("touchend",h)}},[l]),o.useEffect(()=>{const e=document.querySelector('[role="tablist"][aria-label="Market categories"]');if(!e)return;Array.from(e.querySelectorAll("button")).find(r=>r.getAttribute("aria-pressed")==="true")?.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})},[l]),t.jsxs("div",{ref:U,className:"pb-20 md:pb-8",style:{touchAction:"pan-y"},children:[t.jsx("div",{className:"sticky top-14 bg-white border-b border-gray-200 z-30",role:"region","aria-label":"Markets filters",children:t.jsxs("div",{className:"p-4 space-y-3",children:[t.jsx("div",{className:"flex gap-2",children:t.jsxs("div",{className:"relative flex-1",children:[t.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),t.jsx(te,{type:"text",placeholder:"Search pairs...",value:c,onChange:e=>a(e.target.value),className:"pl-10 h-11 rounded-lg","aria-label":"Search pairs"})]})}),t.jsx("div",{className:"flex gap-2 overflow-x-auto hide-scrollbar -mx-4 px-4",role:"tablist","aria-label":"Market categories",children:K.map(e=>t.jsx("button",{onClick:()=>g(e.id),className:`px-4 py-3 rounded-full whitespace-nowrap transition-colors ${l===e.id?"bg-blue-700 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"aria-pressed":l===e.id,"aria-label":`Filter ${e.label}`,children:e.label},e.id))})]})}),t.jsxs("div",{className:"p-4",children:[F&&t.jsx("div",{className:"space-y-2","aria-busy":"true","aria-live":"polite",children:Array.from({length:8}).map((e,n)=>t.jsxs("div",{className:"w-full bg-white rounded-lg p-4 shadow-sm",children:[t.jsx(T,{className:"h-4 w-1/3 mb-2"}),t.jsx(T,{className:"h-3 w-1/5"})]},n))}),A&&t.jsx("div",{className:"text-xs text-red-600 mb-2",children:A}),!F&&E.length===0?t.jsx(se,{icon:t.jsx(H,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),title:"No pairs found",message:"Try adjusting your search or filters",actionLabel:"Reset filters",onAction:()=>{a(""),g("all")}}):t.jsx("div",{className:"space-y-2",ref:y,children:(()=>{const e=Math.min(k,E.length),n=Math.min(D,Math.max(0,e-R)),r=Math.min(e,n+R),i=n*j,d=(e-r)*j,f=E.slice(0,e).slice(n,r);return t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{height:i}}),f.map(s=>t.jsxs("div",{onClick:()=>u(s),className:"relative w-full bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition-all active:scale-[0.98] cursor-pointer",role:"button",tabIndex:0,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),u(s))},"aria-label":`${s.pair} ${M(typeof s.mid=="number"?s.mid:typeof s.rate=="number"?s.rate:typeof s.bidPrice=="number"?s.bidPrice:0,s.pair)}; change ${Number(s.changePercent??s.changePercent24h??0).toFixed(2)} percent`,children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ge,{pair:s.pair}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("p",{className:"text-gray-900 mb-0.5",children:s.pair}),t.jsx("p",{className:"text-xs text-gray-500",children:s.name})]}),t.jsx("div",{className:"text-right",children:(()=>{const h=s.pair,m=typeof s.mid=="number"?s.mid:typeof s.rate=="number"?s.rate:typeof s.bidPrice=="number"?s.bidPrice:0,b=typeof s.changePercent=="number"?s.changePercent:typeof s.changePercent24h=="number"?s.changePercent24h:0;return t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-900 font-mono mb-0.5","aria-live":"polite",children:M(m,h)}),t.jsxs("div",{className:"flex items-center justify-end gap-1",children:[b>=0?t.jsx(ne,{className:"w-3 h-3 text-green-600"}):t.jsx(re,{className:"w-3 h-3 text-red-600"}),t.jsxs("span",{className:`text-xs ${b>=0?"text-green-600":"text-red-600"}`,children:[b>=0?"+":"",Number(b).toFixed(2),"%"]})]})]})})()}),t.jsx("div",{className:"w-12 h-8 flex-shrink-0",children:t.jsx("button",{onClick:h=>{h.stopPropagation(),J(s.pair)},"aria-label":"Toggle favorite",className:"w-8 h-8 rounded-full flex items-center justify-center border border-gray-200 hover:border-gray-300",children:t.jsx(le,{className:`w-4 h-4 ${x.includes(s.pair)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})})})]}),t.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 flex items-center justify-between text-xs","aria-hidden":"true",children:[t.jsxs("span",{className:"text-gray-500",children:["Spread: ",t.jsxs("span",{className:"text-gray-700",children:[s.spread," pips"]})]}),t.jsxs("span",{className:"text-gray-500",children:["24h High: ",t.jsx("span",{className:"text-gray-700 font-mono",children:M(s.high24h,s.pair)})]}),t.jsxs("span",{className:"text-gray-500",children:["24h Low: ",t.jsx("span",{className:"text-gray-700 font-mono",children:M(s.low24h,s.pair)})]})]})]},s.pair)),t.jsx("div",{style:{height:d}})]})})()})]}),t.jsx("style",{children:`
        .hide-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .hide-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `})]})}export{Ne as Markets};
