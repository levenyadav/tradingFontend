import{j as e}from"./radix-DtX1p3s1.js";import{r as s}from"./charts-Dh6mNU2f.js";import{J as re,S as le,K as ne,d as B,E as ie,M as oe,N as ce,O as de,Q as ue,R as xe,k as me,H as he}from"./index-BN51rlWB.js";import"./vendor-DDxydHEc.js";function pe({value:o,onChange:i,onApply:C,onReset:c,onBack:d}){const[u,p]=s.useState(!1),[g,S]=s.useState(o.startDate||""),[x,D]=s.useState(o.endDate||""),f=()=>{i({startDate:g||void 0,endDate:x||void 0}),p(!1)},b=l=>{const w=new Date,y=new Date;y.setDate(w.getDate()-(l-1)),S(y.toISOString().slice(0,10)),D(w.toISOString().slice(0,10))};return e.jsxs("div",{className:"bg-gray-50",children:[e.jsxs("div",{className:"px-4 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-900",children:"Filter Transactions"}),d&&e.jsx("button",{onClick:d,className:"text-sm text-blue-700",children:"Back"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>p(!u),className:"w-full inline-flex items-center justify-between px-3 py-2 rounded bg-white border text-gray-900",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Date Range"]}),e.jsxs("span",{className:"text-xs text-gray-600",children:[o.startDate||"",o.startDate||o.endDate?" – ":"",o.endDate||""]})]}),u&&e.jsxs("div",{className:"absolute left-0 right-0 mt-2 bg-white border rounded shadow p-3 z-20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"date",value:g,onChange:l=>S(l.target.value),className:"border rounded px-2 py-1 text-gray-900 w-full"}),e.jsx("input",{type:"date",value:x,onChange:l=>D(l.target.value),className:"border rounded px-2 py-1 text-gray-900 w-full"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-900",onClick:()=>b(7),children:"Last 7 days"}),e.jsx("button",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-900",onClick:()=>b(30),children:"Last 30 days"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"text-sm text-gray-700",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{className:"text-sm text-blue-700",onClick:f,children:"Apply"})]})]})]}),e.jsxs("select",{value:o.type,onChange:l=>i({type:l.target.value}),className:"w-full border rounded px-3 py-2 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"deposit",children:"Deposit"}),e.jsx("option",{value:"withdrawal",children:"Withdrawal"}),e.jsx("option",{value:"profit_loss",children:"Trade"})]}),e.jsxs("select",{value:o.status,onChange:l=>i({status:l.target.value}),className:"w-full border rounded px-3 py-2 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"failed",children:"Failed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:o.sortBy,onChange:l=>i({sortBy:l.target.value}),className:"w-full border rounded px-3 py-2 text-gray-900 bg-white",children:[e.jsx("option",{value:"createdAt",children:"Date"}),e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"status",children:"Status"})]}),e.jsxs("select",{value:o.sortOrder,onChange:l=>i({sortOrder:l.target.value}),className:"w-full border rounded px-3 py-2 text-gray-900 bg-white",children:[e.jsx("option",{value:"desc",children:"Desc"}),e.jsx("option",{value:"asc",children:"Asc"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:o.limit,onChange:l=>i({limit:Number(l.target.value)}),className:"w-full border rounded px-3 py-2 text-gray-900 bg-white",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"w-4 h-4 absolute left-2 top-2.5 text-gray-500"}),e.jsx("input",{value:o.search||"",onChange:l=>i({search:l.target.value}),placeholder:"Search",className:"w-full border rounded pl-7 pr-2 py-2 text-gray-900 bg-white"})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t px-4 py-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[e.jsx("button",{onClick:C,className:"w-full px-3 py-2 rounded bg-blue-700 text-white",children:"Apply Filter"}),e.jsx("button",{onClick:c,className:"w-full px-3 py-2 rounded border bg-white text-gray-900",children:"Reset"})]})})]})}function we({onBack:o}){const[i,C]=s.useState([]),[c,d]=s.useState(1),[u,p]=s.useState(25),[g,S]=s.useState(0),[x,D]=s.useState(0),[f,b]=s.useState(""),[l,w]=s.useState(""),[y,O]=s.useState("createdAt"),[M,F]=s.useState("desc"),[A,H]=s.useState(""),[R,z]=s.useState(""),[Q,_]=s.useState(!1),[P,I]=s.useState(""),[Y,E]=s.useState(25),m=s.useRef(null),[q,V]=s.useState(0),[k,T]=s.useState(30),[h,X]=s.useState(110),W=s.useRef(null),U=s.useMemo(()=>({page:c,limit:u,sortBy:y,sortOrder:M,type:f||void 0,status:l||void 0,startDate:A||void 0,endDate:R||void 0}),[c,u,y,M,f,l,A,R]);s.useEffect(()=>{let t=!0;return _(!0),I(""),ne(U).then(n=>{if(!t)return;C(n.items||[]);const r=n.pagination;S(r?.total||0),D(r?.pages||0),E(Math.min(25,(n.items||[]).length))}).catch(n=>{if(!t)return;const r=n?.error?.message||n?.message||"Failed to load transactions";I(r)}).finally(()=>{t&&_(!1)}),()=>{t=!1}},[U]),s.useEffect(()=>{const t=()=>{if(window.innerHeight+window.scrollY>=document.body.offsetHeight-200&&E(r=>Math.min(r+25,i.length||r+25)),m.current){const r=m.current.getBoundingClientRect().top+window.scrollY,N=Math.max(0,window.scrollY-r),$=Math.floor(N/Math.max(1,h)),L=Math.max(0,$-10);V(L),T(30)}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[i.length,h]),s.useEffect(()=>{if(!m.current)return;requestAnimationFrame(()=>{const r=m.current.querySelector("div.bg-white")?.getBoundingClientRect().height;r&&r>0&&X(Math.round(r))})},[i.length,q,k,Y]),s.useEffect(()=>{if(!m.current)return;W.current?.disconnect();const t=new IntersectionObserver(()=>{const r=window.innerHeight,N=Math.max(10,Math.ceil(r/Math.max(1,h))+10);T(N)});t.observe(m.current),W.current=t;const n=()=>{const r=Math.max(10,Math.ceil(window.innerHeight/Math.max(1,h))+10);T(r)};return window.addEventListener("resize",n),()=>{t.disconnect(),window.removeEventListener("resize",n)}},[h]),s.useEffect(()=>{const t=()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-200&&E(r=>Math.min(r+25,i.length||r+25))};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[i.length]);const[G,Z]=s.useState(null),ee=t=>{G&&clearTimeout(G);const n=setTimeout(()=>{t.type!==void 0&&b(t.type),t.status!==void 0&&w(t.status),t.sortBy!==void 0&&O(t.sortBy),t.sortOrder!==void 0&&F(t.sortOrder),t.limit!==void 0&&p(t.limit),t.startDate!==void 0&&H(t.startDate||""),t.endDate!==void 0&&z(t.endDate||""),d(1)},300);Z(n)},te=()=>{d(1)},J=()=>{b(""),w(""),O("createdAt"),F("desc"),p(25),H(""),z(""),d(1)},j=c>1,v=x>0&&c<x;return e.jsxs("div",{className:"p-4",children:[e.jsx(pe,{value:{type:f,status:l,sortBy:y,sortOrder:M,limit:u,startDate:A,endDate:R},onChange:ee,onApply:te,onReset:J,onBack:o}),P&&e.jsx("div",{className:"mb-3 bg-red-100 text-red-700 px-3 py-2 rounded",role:"alert","aria-live":"polite",children:P}),e.jsx("div",{className:"space-y-2",ref:m,children:Q?e.jsx("div",{className:"space-y-2","aria-busy":"true","aria-live":"polite",children:Array.from({length:8}).map((t,n)=>e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{className:"h-4 w-1/3 mb-2"}),e.jsx(B,{className:"h-3 w-1/4"})]})]})},n))}):i.length===0?e.jsx(ie,{title:"No transactions found",message:"Try changing filters or date range",actionLabel:"Reset filters",onAction:J}):(()=>{const t=Math.min(Y,i.length),n=Math.min(q,Math.max(0,t-k)),r=Math.min(t,n+k),N=n*h,$=(t-r)*h,L=i.slice(0,t).slice(n,r);return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:N}}),L.map(a=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${a.type==="deposit"?"bg-green-100":a.type==="withdrawal"?"bg-blue-100":a.type==="bonus"?"bg-yellow-100":"bg-purple-100"}`,children:[a.type==="deposit"&&e.jsx(oe,{className:"w-5 h-5 text-green-700"}),a.type==="withdrawal"&&e.jsx(ce,{className:"w-5 h-5 text-blue-700"}),a.type==="bonus"&&e.jsx(de,{className:"w-5 h-5 text-yellow-700"}),a.type==="fee"&&e.jsx(ue,{className:"w-5 h-5 text-purple-700"}),(a.type==="profit_loss"||a.type==="wallet_to_account"||a.type==="account_to_wallet")&&e.jsx(xe,{className:"w-5 h-5 text紫-700"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900",children:a.type==="profit_loss"?`Trade ${a.symbol} • ${a.volume??0} lots @ ${a.price??""}`:a.type.charAt(0).toUpperCase()+a.type.slice(1)}),e.jsx("p",{className:"text-xs text-gray-500",children:a.accountNumber?`Account ${a.accountNumber}`:""})]})]}),e.jsxs("div",{className:"text-right",children:[(()=>{const K=a.direction==="debit"||a.type==="fee"||a.netAmount<0,se=K?"-":"+",ae=Math.abs(a.netAmount);return e.jsxs("p",{className:K?"text-red-600":"text-green-600",children:[se,me(ae,a.currency)]})})(),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${a.status==="completed"?"bg-green-100 text-green-700":a.status==="pending"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:a.status})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:he(a.createdAt)})]},a.id)),e.jsx("div",{style:{height:$}})]})})()}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600",children:g>0?`Showing ${(c-1)*u+1}–${Math.min(c*u,g)} of ${g} • Page ${c}/${x||1}`:""}),e.jsxs("div",{className:"grid grid-cols-2 sm:flex sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{disabled:!j,onClick:()=>j&&d(c-1),className:`px-3 py-2 rounded w-full sm:w-auto ${j?"bg-white text-gray-900 border":"bg-gray-100 text-gray-400"}`,children:"Prev"}),e.jsx("button",{disabled:!v,onClick:()=>v&&d(c+1),className:`px-3 py-2 rounded w-full sm:w-auto ${v?"bg-white text-gray-900 border":"bg-gray-100 text-gray-400"}`,children:"Next"}),e.jsx("button",{disabled:!j,onClick:()=>d(1),className:`hidden sm:inline-flex px-3 py-2 rounded ${j?"bg-white text-gray-900 border":"bg-gray-100 text-gray-400"}`,children:"First"}),e.jsx("button",{disabled:!v,onClick:()=>x&&d(x),className:`hidden sm:inline-flex px-3 py-2 rounded ${v?"bg-white text-gray-900 border":"bg-gray-100 text-gray-400"}`,children:"Last"})]})]})})]})}export{we as Transactions};
