import{j as e}from"./radix-DtX1p3s1.js";import{r as n}from"./charts-Dh6mNU2f.js";import{c as ce,u as de,v as oe,w as h,x as me,y as xe,I as ge,d,z as pe,f as N,C as q,k as _,B as C,E as A,F as ue,G as he,H as J,P as Ne,p as K}from"./index-BN51rlWB.js";import"./vendor-DDxydHEc.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],be=ce("ellipsis-vertical",je);function Le({onClosePosition:ye,onCancelOrder:fe}){const{selectedAccountId:p,accounts:Q}=de(),b=Q.find(s=>String(s._id)===String(p));b?.accountNumber?String(b.accountNumber):p&&String(p).slice(-6),b?.accountType&&String(b.accountType);const[l,X]=n.useState("open"),[M,w]=n.useState(null),[Z,L]=n.useState(!1),[y,f]=n.useState([]),[x,O]=n.useState(null),[v,U]=n.useState(!1),[E,ee]=n.useState(""),[o,D]=n.useState(1),[z,$]=n.useState([]),[se,B]=n.useState(null),[I,F]=n.useState(!1),[te,H]=n.useState({}),[k,ae]=n.useState([]),[T,R]=n.useState(!1),ne=[{id:"open",label:"Open Positions",count:x?.total??y.length},{id:"pending",label:"Pending Orders",count:se?.total??z.length},{id:"history",label:"Trade History",count:k.length}];return n.useEffect(()=>{l==="open"&&(U(!0),oe({page:o,limit:20,sortBy:"createdAt",sortOrder:"desc",symbol:E||void 0}).then(s=>{const a=String(p||""),c=a?(s.items||[]).filter(t=>{const m=String(t?.account?.id||t?.accountId?._id||"");return m&&m===a}):s.items||[];f(c),O(s.pagination||null)}).finally(()=>U(!1)))},[l,E,o,p]),n.useEffect(()=>{if(l!=="open")return;h.connect();const s=t=>{const m=String(t.symbol||"").toUpperCase();f(r=>{if(!r||r.length===0)return r;let u=r;for(let P=0;P<r.length;P++){const i=r[P];if(typeof t.id=="string"&&String(i.id||"")===t.id||typeof t.positionId=="string"&&String(i.positionId||"")===t.positionId||String(i.symbol||"").toUpperCase()===m){const ie=typeof t.currentPrice=="number"?t.currentPrice:i.currentPrice,V=typeof t.unrealizedPL=="number"?t.unrealizedPL:i.unrealizedPL,re=typeof t.pipMovement=="number"?t.pipMovement:i.pips,le=i.margin&&Number(i.margin)>0?Number(V||0)/Number(i.margin)*100:i.unrealizedPLPercent,Y=typeof t.commission=="number"?t.commission:i.commission,G=typeof t.swap=="number"?t.swap:i.swap,W=typeof t.spread=="number"?t.spread:i.spread,S=typeof t.totalCosts=="number"?t.totalCosts:i.totalCosts,g=t.costs||i.costs,j=g?{commission:typeof g.commission=="number"?g.commission:Y,swap:typeof g.swap=="number"?g.swap:G,spread:typeof g.spread=="number"?g.spread:W,total:typeof g.total=="number"?g.total:typeof S=="number"?S:void 0}:{commission:Y,swap:G,spread:W,total:typeof S=="number"?S:void 0};u===r&&(u=[...r]),u[P]={...i,currentPrice:ie,unrealizedPL:V,pips:re,unrealizedPLPercent:le,commission:j.commission,swap:j.swap,spread:j.spread,totalCosts:j.total,costs:j}}}return u})},a=t=>{try{K("position-closed")}catch{}const m=String(t?.id||t?._id||t?.positionId||"");m&&(f(r=>r.filter(u=>String(u.id||u._id)!==m)),O(r=>r&&{...r,total:Math.max(0,(r.total||0)-1)}))},c=t=>{try{K("position-opened")}catch{}};return h.on("PNL_UPDATE",s),h.on("POSITION_CLOSED",a),h.on("POSITION_OPENED",c),()=>{h.off("PNL_UPDATE",s),h.off("POSITION_CLOSED",a),h.off("POSITION_OPENED",c)}},[l]),n.useEffect(()=>{l==="pending"&&(F(!0),me({page:1,limit:50}).then(s=>{$(s.items),B(s.meta||null)}).finally(()=>F(!1)))},[l,p]),n.useEffect(()=>{l==="history"&&(R(!0),xe({page:1,limit:20,sortBy:"closedAt",sortOrder:"desc"}).then(s=>{const a=String(p||""),c=a?(s||[]).filter(t=>{const m=String(t?.account?.id||t?.accountId?._id||"");return m&&m===a}):s||[];ae(c)}).finally(()=>R(!1)))},[l,p]),e.jsxs("div",{className:"pb-20 md:pb-8",children:[e.jsx("div",{className:"sticky top-14 bg-white border-b border-gray-200 z-30",children:e.jsx("div",{className:"flex items-center justify-between",children:ne.map(s=>e.jsxs("button",{onClick:()=>X(s.id),className:`flex-1 px-4 py-3 text-sm transition-colors relative ${l===s.id?"text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:[s.label,s.count>0&&e.jsx("span",{className:`ml-1 px-1.5 py-0.5 rounded text-xs ${l===s.id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:s.count}),l===s.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-700"})]},s.id))})}),e.jsxs("div",{className:"p-4",children:[l==="open"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-700 mb-1",children:"Positions"}),e.jsx("p",{className:"text-blue-900",children:x?.total??y.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-700 mb-1",children:"Filter"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(ge,{placeholder:"Symbol e.g. EUR/USD",value:E,onChange:s=>ee(s.target.value.toUpperCase())})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-700 mb-1",children:"Page"}),e.jsx("p",{className:"text-blue-900",children:x?.page??1})]})]})}),e.jsxs("div",{className:"space-y-3",children:[v&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4","aria-busy":"true","aria-live":"polite",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"h-4 w-1/3"}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"})]})]})}),!v&&y.map(s=>{const a=pe({symbol:String(s.symbol),direction:String(s.direction),volume:Number(s.volume),openPrice:Number(s.openPrice),currentPrice:Number(s.currentPrice),unrealizedPL:Number(s.unrealizedPL??0),margin:Number(s.margin??0),pips:Number(s.pips??0),unrealizedPLPercent:Number(s.unrealizedPLPercent??0)}),c=a.calculated.unrealizedPL,t=a.calculated.unrealizedPLPercent;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 cursor-pointer",role:"button",onClick:()=>{w(String(s.id)),L(!0)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-900",children:s.symbol}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.direction==="buy"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.direction.toUpperCase()})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>w(M===s.id?null:s.id),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(be,{className:"w-5 h-5 text-gray-600"})})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Entry"}),e.jsx("p",{className:"text-gray-900 font-mono",children:N(Number(s.openPrice),s.symbol)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Current"}),e.jsx("p",{className:"text-gray-900 font-mono",children:N(Number(s.currentPrice),s.symbol)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Lots"}),e.jsx("p",{className:"text-gray-900",children:Number(s.volume)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Time"}),e.jsx("p",{className:"text-gray-900",children:q(String(s.openedAt))})]})]}),s.stopLoss||s.takeProfit?e.jsxs("div",{className:"flex gap-3 mb-3 text-xs",children:[s.stopLoss?e.jsxs("div",{className:"flex-1 bg-red-50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-red-700",children:"SL set: "}),e.jsx("span",{className:"text-red-900 font-mono",children:N(Number(s.stopLoss),s.symbol)})]}):null,s.takeProfit?e.jsxs("div",{className:"flex-1 bg-green-50 rounded px-2 py-1",children:[e.jsx("span",{className:"text-green-700",children:"TP set: "}),e.jsx("span",{className:"text-green-900 font-mono",children:N(Number(s.takeProfit),s.symbol)})]}):null]}):null,e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:`${c>=0?"text-green-600":"text-red-600"}`,children:[e.jsx("p",{className:"text-lg",children:_(c)}),e.jsxs("p",{className:"text-xs",children:[t.toFixed(2),"%"]})]}),e.jsx(C,{onClick:()=>{w(String(s.id)),L(!0)},variant:"outline",className:"h-9 border-red-600 text-red-600 hover:bg-red-50 rounded-lg",children:"Close Position"})]})]},s.id)}),!v&&y.length===0&&e.jsx(A,{title:"No open positions",message:"Your open positions will appear here"}),!v&&(x?.pages??1)>1&&e.jsxs("div",{className:"flex items-center justify-center gap-3 pt-2",children:[e.jsx(C,{variant:"outline",disabled:o<=1,onClick:()=>D(Math.max(1,o-1)),children:"Prev"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",x?.page??o," / ",x?.pages??1]}),e.jsx(C,{variant:"outline",disabled:x?o>=(x.pages??1):!0,onClick:()=>D((x?.pages??o)>o?o+1:o),children:"Next"})]})]})]}),l==="pending"&&e.jsxs("div",{className:"space-y-3",children:[I&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4","aria-busy":"true","aria-live":"polite",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"h-4 w-1/3"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"})]})]})}),!I&&z.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-900",children:s.symbol}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs capitalize ${s.type==="limit"?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:s.type}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${s.direction==="buy"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.direction.toUpperCase()})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Lots"}),e.jsx("p",{className:"text-gray-900",children:s.volume})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Created"}),e.jsx("p",{className:"text-gray-900",children:q(s.createdAt)})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm text-orange-600",children:"Waiting for price..."}),e.jsx(C,{onClick:async()=>{H(a=>({...a,[s.id]:!0}));try{await he(s.id),$(a=>a.filter(c=>c.id!==s.id)),B(a=>a&&{...a,total:Math.max(0,(a.total||0)-1)})}catch{}finally{H(a=>({...a,[s.id]:!1}))}},variant:"outline",className:"h-9 border-gray-300 rounded-lg",children:te[s.id]?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ue,{size:14})," ",e.jsx("span",{children:"Canceling..."})]}):"Cancel Order"})]})]},s.id)),!I&&z.length===0&&e.jsx(A,{title:"No pending orders",message:"Your pending orders will appear here"})]}),l==="history"&&e.jsxs("div",{className:"space-y-3",children:[T&&e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4","aria-busy":"true","aria-live":"polite",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"h-4 w-1/3"}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"}),e.jsx(d,{className:"h-5"})]})]})}),!T&&k.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-900",children:s.symbol}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${String(s.direction)==="buy"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:String(s.direction).toUpperCase()})]}),e.jsx("div",{className:`text-right ${Number(s.profitLoss??s.unrealizedPL??0)>=0?"text-green-600":"text-red-600"}`,children:e.jsxs("p",{className:"text-lg",children:[Number(s.profitLoss??s.unrealizedPL??0)>=0?"+":"",_(Number(s.profitLoss??s.unrealizedPL??0))]})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Entry"}),e.jsx("p",{className:"text-gray-900 font-mono",children:N(Number(s.openPrice),s.symbol)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Exit"}),e.jsx("p",{className:"text-gray-900 font-mono",children:N(Number(s.closePrice??s.currentPrice),s.symbol)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Lots"}),e.jsx("p",{className:"text-gray-900",children:Number(s.volume)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Commission"}),e.jsx("p",{className:"text-gray-900",children:_(Number(s.commission||0))})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-3 border-t border-gray-100",children:[e.jsxs("p",{children:["Opened: ",s.openedAt?J(String(s.openedAt)):"-"]}),e.jsxs("p",{children:["Closed: ",s.closedAt?J(String(s.closedAt)):"-"]})]})]},s.id)),!T&&k.length===0&&e.jsx(A,{title:"No trade history",message:"Closed positions will appear here"})]})]}),e.jsx(Ne,{open:Z,onOpenChange:L,positionId:M,onClosed:s=>{f(a=>a.filter(c=>String(c.id||c._id)!==String(s))),O(a=>a&&{...a,total:Math.max(0,(a.total||0)-1)})}})]})}export{Le as Portfolio};
